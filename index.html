<html>
<head>
  <title>search-auctions</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <link rel="shortcut icon" href="favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/sticky-footer-navbar.css" rel="stylesheet">
  <script src="js/allegro.js"></script>
  <script src="js/ebay.js"></script>
  <script src="js/gumtree.js"></script>
  <script src="js/sprzedajemy.js"></script>
  <script src="js/swistak.js"></script>
  <script src="js/tablica.js"></script>
  <script type="text/javascript">
  function search() {
    var q = document.getElementById("query").value;
    q = q.replace(" ", "+");
    var loc = $('#location').text();
    if (loc == 'Cała Polska') {
      loc = null;
    } else {
      loc = loc.toLowerCase();
      loc = loc.replace('ł', 'l');
      loc = loc.replace('ń', 'n');
      loc = loc.replace('ó', 'o');
      loc = loc.replace('ź', 'z');
      loc = loc.trim();
    }

    // Allegro is always checked
    window.location.href = new Allegro(q, loc).getSearchUrl();
    openInNewTab("ebay", new Ebay(q, loc));
    openInNewTab("gumtree", new Gumtree(q, loc));
    openInNewTab("sprzedajemy", new Sprzedajemy(q, loc));
    openInNewTab("swistak", new Swistak(q, loc));
    openInNewTab("tablica", new Tablica(q, loc));
  }
  function openInNewTab(id, handler) {
    if (document.getElementById(id).checked) {
      window.open(handler.getSearchUrl(), "_blank");
      enableSite(id);
    } else {
      disableSite(id);
    }
	}
  function isSiteDisabled(id) {
    if (typeof localStorage.disabled_sites != "undefined")
      return localStorage.disabled_sites.indexOf(id) != -1;
    return false;
  }
  function isSiteEnabled(id) {
    return !isSiteDisabled(id);
  }
  function disableSite(id) {
    if (typeof localStorage.disabled_sites == "undefined")
      localStorage.disabled_sites = id;
    else if (!isSiteDisabled(id))
      localStorage.disabled_sites = localStorage.disabled_sites + id;
  }
  function enableSite(id) {
    if (typeof localStorage.disabled_sites != "undefined" && isSiteDisabled(id))
      localStorage.disabled_sites = localStorage.disabled_sites.replace(id, ""); 
  }
  </script>
</head>
<body>

  <div id="wrap">

  <div class="container">

    <div class="page-header">
        <h1>Szukaj <small>na kilku serwisach aukcyjnych równocześnie</small></h1>
    </div>

    <form action="#" onsubmit="return false;">
    <div class="input-group input-group-lg">

      <span class="input-group-btn">
      <button id="location" type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">Cała Polska<span class="caret"></span></button>
      <ul class="dropdown-menu" role="menu">
        <li><a href="#">Cała Polska</a></li>
        <li class="divider"></li>
        <li><a href="#">Gdańsk</a></li>
        <li><a href="#">Katowice</a></li>
        <li><a href="#">Kraków</a></li> <!-- l3200208 -->
        <li><a href="#">Lublin</a></li>
        <li><a href="#">Łódź</a></li> <!-- l3200183 -->
        <li><a href="#">Poznań</a></li>
        <li><a href="#">Szczecin</a></li>
        <li><a href="#">Warszawa</a></li>
        <li><a href="#">Wrocław</a></li>
      </ul>
      </span> 
     
      <input type="text" class="form-control" placeholder="czego dusza pragnie?" id="query"/>
      <span class="input-group-btn">
        <button id="submit" class="btn btn-default" onclick="search()">
            <span class="glyphicon glyphicon-search"></span>
        </button>
      </span>
  
    </div>

    <!-- spacer: https://github.com/twbs/bootstrap/issues/4286 -->
    <div style="height: 20px; width: 100%; font-size: 0; margin: 0; padding: 0; border: 0; display: block;"></div>

    <div class="panel-group" id="accordion">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h4 class="panel-title">
            <a data-toggle="collapse" data-parent="#accordion" href="#advancedOptions">więcej opcji</a>
          </h4>
        </div>
        <div id="advancedOptions" class="panel-collapse collapse">
          <div class="panel-body">
            <div class="form-group">
              <div class="col-sm-10">
               <div class="checkbox">
                  <label>
                    <input type="checkbox" id="allegro" checked disabled>Allegro</input>
                  </label>
                </div>
                <div class="checkbox">
                 <label>
                   <input type="checkbox" id="ebay">eBay</input>
                 </label>
                </div>
                <div class="checkbox">
                  <label>
                   <input type="checkbox" id="gumtree">Gumtree</input>
                 </label>
                </div>
                <div class="checkbox">
                 <label>
                   <input type="checkbox" id="sprzedajemy">Sprzedajemy</input>
                 </label>
                </div>
                <div class="checkbox">
                 <label>
                   <input type="checkbox" id="swistak">Świstak</input>
                 </label>
                </div>
                <div class="checkbox">
                  <label>
                    <input type="checkbox" id="tablica">Tablica</input>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </form>

  </div>
</div>

</div>

    <div id="footer">
      <div class="container">
        <p class="text-muted text-right">uwagi i sugestie zgłaszać <a href="https://github.com/zaza/search-auctions/issues?state=open">tutaj</a></p>
      </div>
    </div>

  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://code.jquery.com/jquery.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script type="text/javascript">
    $('#query').focus();

    // initial selection
    //$("#allegro").attr("checked", isSiteEnabled("allegro"));
    $("#ebay").attr("checked", isSiteEnabled("ebay"));
    $("#gumtree").attr("checked", isSiteEnabled("gumtree"));
    $("#sprzedajemy").attr("checked", isSiteEnabled("sprzedajemy"));
    $("#swistak").attr("checked", isSiteEnabled("swistak"));
    $("#tablica").attr("checked", isSiteEnabled("tablica"));

    // dropdown update
    $('.dropdown-menu li a').click(function () {
      var newHeading = $(this).text();
      var $heading = $('#location');
      var $caret = $('.caret', $heading);
      $heading.html(newHeading + ' ').append($caret);
    });
  </script>
</body>
</html>